<?php	$parse_uri = explode( 'wp-content', $_SERVER['SCRIPT_FILENAME'] );	$wp_load = $parse_uri[0] . 'wp-load.php';	include_once '/home1/andrux/dev/wp-load.php'; //$wp_load;	/* connect to the database */	$conn = mysqli_connect( DB_HOST, DB_USER, DB_PASSWORD, DB_NAME );	if ( mysqli_connect_errno() )		die( 'Connection Error: ' . mysqli_connect_error() );	$options = get_option( 'db-query-queries' );	/* most queries are saved with escaping quotes */	$query = stripslashes( $options[ $_GET['id'] ]['query'] );	$result = @mysqli_query( $conn, $query );	if ( ! $result )		die( 'Couldn\'t execute query. ' . mysqli_error( $conn ) );	while ( $column = mysqli_fetch_field( $result ) ) {		$columns[] = $column->name;	}	/* get this user's role permissions */	$role_can = DB_Viewer_Editor::get_role_permissions( $_GET['id'] );	for ( $i = 0; $i < count( $columns ); $i++ ) {		$editor_option = ( $i == 0 ) || ! $role_can->edit ? "" : "editor: {type: 'text'}";		$column_model[] = "{field: '" . $columns[ $i ] . "', title: '" . $columns[ $i ] . "', width: 60, sortable: true, " . $editor_option . "}";	}	if ( $role_can->edit ) {		$remove_link = ( $role_can->remove )			? "'<a class=\"icon-remove\" style=\"text-decoration: none; padding: 0px 5px;\" href=\"#\" onclick=\"deleterow( this )\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>';"			: "'';";		/* build datagrid columns */		$action_column = array(			"{field: 'action', title: 'Action', width: 60, align: 'center',",				"formatter: function( value, row, index ) {",					"if ( row.editing ) {",						"var s = '<a class=\"icon-save\" style=\"text-decoration: none; padding: 0px 5px;\" href=\"#\" onclick=\"saverow( this )\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a> ';",						"var c = '<a class=\"icon-cancel\" style=\"text-decoration: none; padding: 0px 5px;\" href=\"#\" onclick=\"cancelrow( this )\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>';",						"return s+c;",					"}",					"else {",						"var e = '<a class=\"icon-edit\" style=\"text-decoration: none; padding: 0px 5px;\" href=\"#\" onclick=\"editrow( this )\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a> ';",						"var d = $remove_link",						"return e + d;",					"}",				"}",			"}"		);		$column_model[] = implode( '', $action_column );	}?><link rel="stylesheet" href="css/icon.css" type="text/css" media="all" /><link rel="stylesheet" href="css/easyui.css" type="text/css" media="all" /><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/jquery.easyui.min.js"></script><script type="text/javascript" src="js/jquery.edatagrid.js"></script><script type="text/javascript">	jQuery( document ).ready( function ( $ ) {		/* manage editing shortcode records datagrid */		$( '#shortcode-datagrid' ).edatagrid({			url: 'shortcode-query.php?id=<?php echo $_GET['id']; ?>',			updateUrl: '<?php echo admin_url( 'admin-ajax.php' ); ?>?action=shortcode_update_record',			title: '<?php echo $options[ $_GET['id'] ]['description']; ?>',			width: 'auto',			height: '<?php echo ( intval( $options[ $_GET['id'] ]['maxrows'] ) + 4 ) * 25; ?>',			pagination: true,			singleSelect: true,			idField: '<?php echo $columns[0]; ?>',			fitColumns: true,			rownumbers: true,			sortName: '<?php echo $columns[0]; ?>',			sortOrder: 'asc',			pageSize: <?php echo $options[ $_GET['id'] ]['maxrows']; ?>,			pageList: [ 10, 25, 50, 100, 250 ],			autoRowHeight: false,			columns:[[				{field: 'shortcode_table', title: 'Table Name', hidden: true},				<?php echo implode( ",", $column_model ); ?>			]],			onBeforeEdit: function( index, row ) {				row.editing = true;				updateActions( index );			},			onAfterEdit: function( index, row ) {				row.editing = false;				updateActions( index );			},			onCancelEdit: function( index, row ) {				row.editing = false;				updateActions( index );			},			onLoadSuccess: function() {				/* every time the datagrid is loaded calculate its height: 1 row + 4 = 25 px */				var numRows = ( $( this ).datagrid( 'getRows' ).length > 5 ) ? $( this ).datagrid( 'getRows' ).length + 4 : 9;				var h = ( numRows ) * 25;				$( this ).datagrid( 'resize', { height: h });				/* resize also the iframe - add 12 px to account for margins */				$( window.parent.document.getElementsByTagName( 'iframe' )[0] ).height( h + 12 );			}		});	});	function updateActions( index ) {		$( '#shortcode-datagrid' ).datagrid( 'updateRow', {			index: index,			row: {}		});	}	function getRowIndex( target ) {		var tr = $( target ).closest( 'tr.datagrid-row' );		return parseInt( tr.attr( 'datagrid-row-index' ) );	}	function editrow( target ) {		$( '#shortcode-datagrid' ).datagrid( 'beginEdit', getRowIndex( target ) );	}	function deleterow( target ) {		$.messager.confirm( 'Confirm', 'Are you sure you want to delete this record?', function( r ) {			if ( r ) {				var data = {};				data.action = 'shortcode_delete_record';				data.row = $( '#shortcode-datagrid' ).datagrid( 'getRows' )[ getRowIndex( target ) ];				$.post( '<?php echo admin_url( 'admin-ajax.php' ); ?>', data, function( response ) {					if ( $.parseJSON( response ).success )						$( '#shortcode-datagrid' ).datagrid( 'deleteRow', getRowIndex( target ) );				});			}		});	}	function saverow( target ) {		$( '#shortcode-datagrid' ).datagrid( 'endEdit', getRowIndex( target ) )	}	function cancelrow( target ) {		$( '#shortcode-datagrid' ).datagrid( 'cancelEdit', getRowIndex( target ) );	}</script><table id="shortcode-datagrid"></table>