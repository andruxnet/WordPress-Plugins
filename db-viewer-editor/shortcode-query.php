<?php	/* get all sorting and pagination parameters */	$page = isset( $_POST['page'] ) ? intval( $_POST['page'] ) : 1;	$rows = isset( $_POST['rows'] ) ? intval( $_POST['rows'] ) : 10;	$sort = isset( $_POST['sort'] ) ? strval( $_POST['sort'] ) : 'id';	$order = isset( $_POST['order'] ) ? strval( $_POST['order'] ) : 'asc';	$offset = ( $page - 1 ) * $rows;	/* we need to be able to make use of the Wordpress core */	$parse_uri = explode( 'wp-content', $_SERVER['SCRIPT_FILENAME'] );	$wp_load = $parse_uri[0] . 'wp-load.php';	include_once $wp_load;	/* connect to the database */	$conn = mysqli_connect( DB_HOST, DB_USER, DB_PASSWORD, DB_NAME );	if ( mysqli_connect_errno() )		die( 'Connection Error: ' . mysqli_connect_error() );	$options = get_option( 'db-query-queries' );	/* most queries are saved with escaping quotes, also add the query id to the resultset */	$query = stripslashes( $options[ $_GET['id'] ]['query'] );	/* run query for complete results */	$result = @mysqli_query( $conn, $query );	if ( ! $result )		die( 'Couldn\'t execute query. ' . mysqli_error( $conn ) );	/* get the total rows returned */	$row_count = mysqli_num_rows( $result );	/* get the name of the table used in the query */	$fields = mysqli_fetch_field_direct( $result, 0 );	/* make sure we free the result object */	mysqli_free_result( $result );	/* run query for paginated results */	$result = @mysqli_query( $conn, "$query order by $sort $order limit $offset, $rows" );	if ( ! $result )		die( 'Couldn\'t execute query. ' . mysqli_error( $conn ) );	/* start grabbing data to be returned */	$response = array();	$response['total'] = $row_count;	$items = array();	while ( $row = mysqli_fetch_object( $result ) ) {		$row->shortcode_table = $fields->table;		$items[] = $row;	}	$response['rows'] = $items;	echo json_encode( $response );